{
  "version": 3,
  "sources": ["../src/system.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/dep.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts", "../src/watch.ts"],
  "sourcesContent": ["import { ReactiveEffect } from './effect'\nimport { Dep, Sub } from './dep'\nimport { ComputedRefImpl } from './computed'\n\nexport class Link {\n  dep: Dep\n  sub: Sub\n  nextSub: Link | undefined\n  prevSub: Link | undefined\n  nextDep: Link | undefined\n\n  constructor(dep: Dep, sub: Sub) {\n    this.dep = dep\n    this.sub = sub\n  }\n}\n\n/**\n * \u94FE\u63A5\u94FE\u8868\u5173\u7CFB\n * @param dep\n * @param sub\n */\nexport function link(dep: Dep, sub: Sub) {\n  const currentDep = sub.depsTail\n  const nextDep = currentDep === undefined ? sub.deps : currentDep.nextDep\n\n  if (nextDep && nextDep.dep === dep) {\n    sub.depsTail = nextDep\n    return\n  }\n\n  const link = new Link(dep, sub)\n\n  // \u5C06\u672A\u88AB\u590D\u7528\u7684\u8282\u70B9\u653E\u5728\u5F53\u524D\u8282\u70B9\u7684\u540E\u9762, \u7528\u4E8E\u6E05\u7406\n  link.nextDep = nextDep\n\n  /**\n   * \u5173\u8054\u94FE\u8868\u548Cdep\u7684\u5173\u7CFB, \u5206\u4E24\u79CD\u60C5\u51B5\n   * 1. \u5C3E\u8282\u70B9\u6CA1\u6709, \u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054, \u90A3\u5C31\u5F80\u5934\u8282\u70B9\u52A0, \u5934\u5C3E\u76F8\u540C\n   * 2. \u5C3E\u8282\u70B9\u6709, \u90A3\u5C31\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0, \u5E76\u4E14\u66F4\u65B0\u5C3E\u6307\u9488\n   */\n  if (!dep.subsTail) {\n    dep.subs = link\n    dep.subsTail = link\n  } else {\n    dep.subsTail.nextSub = link\n    link.prevSub = dep.subsTail\n    dep.subsTail = link\n  }\n\n  /**\n   * \u5173\u8054\u94FE\u8868\u548Csub\u7684\u5173\u7CFB,\u5206\u4E24\u79CD\u60C5\u51B5\n   * 1. \u5C3E\u8282\u70B9\u6CA1\u6709, \u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054, \u90A3\u5C31\u5F80\u5934\u8282\u70B9\u52A0, \u5934\u5C3E\u76F8\u540C\n   * 2. \u5C3E\u8282\u70B9\u6709, \u90A3\u5C31\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0, \u5E76\u4E14\u66F4\u65B0\u5C3E\u6307\u9488\n   */\n  if (!sub.depsTail) {\n    sub.deps = link\n    sub.depsTail = link\n  } else {\n    sub.depsTail.nextDep = link\n    sub.depsTail = link\n  }\n}\n\nfunction processComputedUpdate(sub: ComputedRefImpl) {\n  /**\n   * \u66F4\u65B0\u8BA1\u7B97\u5C5E\u6027\n   * 1. \u8C03\u7528 update\n   * 2. \u901A\u77E5 subs \u94FE\u8868\u4E0A\u6240\u6709\u7684 sub, \u91CD\u65B0\u6267\u884C\n   */\n  if (sub.subs && sub.update()) {\n    propagate(sub.subs)\n  }\n}\n\n/**\n * \u4F20\u64AD\u66F4\u65B0\u7684\u51FD\u6570\n * @param subs\n */\nexport function propagate(subs: Link) {\n  let link = subs\n  const queuedEffects = []\n  while (link) {\n    const sub = link.sub\n    if (!sub.tracking && !sub.dirty) {\n      sub.dirty = true\n      if ('update' in sub) {\n        // TODO \u5904\u7406 computed\n        processComputedUpdate(sub)\n      } else {\n        queuedEffects.push(sub)\n      }\n    }\n    link = link.nextSub\n  }\n  queuedEffects.forEach(effect => effect.notify())\n}\n\n/**\n * \u5F00\u59CB\u8FFD\u8E2A\u4F9D\u8D56, \u5C06depsTail\u5C3E\u8282\u70B9\u8BBE\u7F6E\u6210undefined\n * @param sub\n */\nexport function startTrack(sub: Sub) {\n  sub.tracking = true\n  // \u526F\u4F5C\u7528\u51FD\u6570\u9996\u6B21\u6216\u91CD\u590D\u6267\u884C\u65F6, \u5C06\u5C3E\u8282\u70B9\u7F6E\u4E3A\u7A7A, \u5F00\u59CB\u91CD\u65B0\u6536\u96C6\u4F9D\u8D56\n  sub.depsTail = undefined\n}\n\n/**\n * \u7ED3\u675F\u8FFD\u8E2A\uFF0C\u627E\u5230\u9700\u8981\u6E05\u7406\u7684\u4F9D\u8D56\uFF0C\u65AD\u5F00\u5173\u8054\u5173\u7CFB\n * @param sub\n */\nexport function endTrack(sub: Sub) {\n  sub.tracking = false\n  const depsTail = sub.depsTail\n  // \u8FFD\u8E2A\u5B8C\u4E86\uFF0C\u4E0D\u810F\u4E86\n  sub.dirty = false\n  /**\n   * 1. \u7ED3\u675F\u8FFD\u8E2A\u540E, \u6709   \u5C3E\u8282\u70B9 \u5E76\u4E14\u8FD8\u6709\u4E0B\u4E00\u4E2A\u8282\u70B9, \u5219\u6E05\u7406\u6389\u4ED6\u4EEC\n   * 2. \u7ED3\u675F\u8FFD\u8E2A\u540E, \u6CA1\u6709 \u5C3E\u8282\u70B9, \u5219\u4ECE\u5934\u90E8\u5F00\u59CB\u6E05\u7406\n   */\n  if (depsTail) {\n    if (depsTail.nextDep) {\n      clearTracking(depsTail.nextDep)\n      depsTail.nextDep = undefined\n    }\n  } else {\n    clearTracking(sub.deps)\n    sub.deps = undefined\n  }\n}\n\n/**\n * \u6E05\u9664\u4F9D\u8D56\u94FE\u8868\u5173\u7CFB\n * @param link\n */\nexport function clearTracking(link: Link) {\n  while (link) {\n    const { nextSub, nextDep, prevSub } = link\n\n    /**\n     * \u5904\u7406\u7EB5\u5411\u94FE\u8868\n     * 1. \u5982\u679C\u5F53\u524D\u8282\u70B9\u6709\u4E0A\u4E00\u4E2A\u8282\u70B9, \u5C31\u5C06\u4E0A\u4E00\u4E2A\u8282\u70B9\u7684nextSub\u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u4E0B\u4E00\u4E2A\u8282\u70B9, \u5F53\u524D\u8282\u70B9\u7684nextSub\u7F6E\u7A7A\n     * 2. \u5426\u5219\u4EE3\u8868\u5F53\u524D\u662F\u5934\u8282\u70B9, \u5C06\u5934\u8282\u70B9\u6307\u9488\u6307\u5411\u4E0B\u4E00\u4E2A\u8282\u70B9\n     */\n    if (prevSub) {\n      prevSub.nextSub = nextSub\n      link.nextSub = undefined\n    } else {\n      link.dep.subs = nextSub\n    }\n\n    /**\n     * \u5904\u7406\u6A2A\u5411\u94FE\u8868\n     * 1. \u5982\u679C\u5F53\u524D\u8282\u70B9\u6709\u4E0B\u4E00\u4E2A\u8282\u70B9, \u5C31\u628A\u4E0B\u4E00\u4E2A\u8282\u70B9\u7684prevSub, \u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u4E0A\u4E00\u4E2A\u8282\u70B9, \u5F53\u524D\u8282\u70B9\u7684prevSub\u7F6E\u7A7A\n     * 2. \u5426\u5219\u4EE3\u8868\u5F53\u524D\u8282\u70B9\u662F\u5C3E\u8282\u70B9, \u5C06\u5C3E\u8282\u70B9\u6307\u9488\u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u4E0A\u4E00\u4E2A\u8282\u70B9\n     */\n    if (nextSub) {\n      nextDep.prevSub = prevSub\n      link.prevSub = undefined\n    } else {\n      link.dep.subsTail = prevSub\n    }\n\n    link.dep = undefined\n    link.sub = undefined\n\n    link = nextDep\n  }\n}\n", "import { endTrack, Link, startTrack } from './system'\r\nimport { Sub } from './dep'\r\n\r\ninterface Fn {\r\n  (...args: any[]): any\r\n}\r\n\r\nexport let activeSub: Sub | undefined\r\n\r\nexport function setActiveSub(sub: Sub) {\r\n  activeSub = sub\r\n}\r\n\r\nexport class ReactiveEffect {\r\n  // \u8868\u793A\u8FD9\u4E2A effect \u662F\u5426\u6FC0\u6D3B\r\n  active = true\r\n\r\n  deps: Link | undefined\r\n  depsTail: Link | undefined\r\n  tracking = false\r\n  dirty = false\r\n\r\n  constructor(public fn) {}\r\n  run() {\r\n    const prevSub = activeSub\r\n    setActiveSub(this)\r\n    // if (this.deps && this.deps.dep) {\r\n    //   this.deps.dep.subsTail = undefined\r\n    // }\r\n\r\n    startTrack(this)\r\n    try {\r\n      return this.fn()\r\n    } finally {\r\n      endTrack(this)\r\n      setActiveSub(prevSub)\r\n    }\r\n  }\r\n  scheduler() {\r\n    this.run()\r\n  }\r\n  notify() {\r\n    this.scheduler()\r\n  }\r\n  stop() {\r\n    if (this.active) {\r\n      // \u6E05\u7406\u4F9D\u8D56\r\n      startTrack(this)\r\n      endTrack(this)\r\n    }\r\n  }\r\n}\r\n\r\nexport function effect(fn: Fn, options?: { scheduler?: Fn }) {\r\n  const e = new ReactiveEffect(fn)\r\n  if (options) {\r\n    Object.assign(e, options)\r\n  }\r\n  e.run()\r\n  /**\r\n   * \u7ED1\u5B9A\u51FD\u6570\u7684 this\r\n   */\r\n  const runner = e.run.bind(e)\r\n\r\n  /**\r\n   * \u628A effect \u7684\u5B9E\u4F8B, \u653E\u5230\u51FD\u6570\u5C5E\u6027\u4E2D\r\n   */\r\n  runner.effect = e\r\n  return runner\r\n}\r\n", "export function isObject(value) {\n  return typeof value === 'object' && value !== null\n}\n\nexport function hasChanged(newValue, oldValue) {\n  return !Object.is(newValue, oldValue)\n}\n\nexport function isFunction(value) {\n  return typeof value === 'function'\n}\n", "import { Link } from './system'\n\nexport class Dep {\n  subs: Link | undefined\n  subsTail: Link | undefined\n  _value\n  constructor(dep) {\n    this._value = dep\n  }\n}\n\nexport interface Sub {\n  deps: Link | undefined\n  depsTail: Link | undefined\n  tracking: boolean\n  dirty: boolean\n}\n", "import { hasChanged, isObject } from '@vue/shared'\nimport { activeSub } from './effect'\nimport { link, propagate } from './system'\nimport { isRef } from './ref'\nimport { Dep } from './dep'\n\nconst mutableHandlers = {\n  get(target, key, receiver) {\n    if (key === '__v_isReactive') return true\n    /**\n     * target = { a: 0 }\n     * \u6536\u96C6\u4F9D\u8D56, \u7ED1\u5B9A target \u4E2D\u67D0\u4E00\u4E2A key \u548C sub \u4E4B\u95F4\u7684\u5173\u7CFB\n     */\n\n    track(target, key)\n\n    const res = Reflect.get(target, key, receiver)\n\n    if (isRef(res)) {\n      /**\n       * target = { a: ref(0) }\n       * \u5982\u679C target.a \u662F\u4E00\u4E2A ref, \u90A3\u4E48\u5C31\u76F4\u63A5\u628A\u503C\u7ED9\u5B83, \u4E0D\u8981\u8BA9\u5B83 .value\n       */\n      return res.value\n    }\n\n    if (isObject(res)) {\n      /**\n       * \u5982\u679C\u8BBF\u95EE\u7684\u662F\u5D4C\u5957\u5BF9\u8C61, \u90A3\u4E48\u5C31\u7528 reactive \u5305\u88F9\u4E00\u4E0B\n       */\n      return reactive(res)\n    }\n\n    return res\n  },\n  set(target, key, newValue, receiver) {\n    /**\n     * \u89E6\u53D1\u66F4\u65B0, set \u7684\u65F6\u5019, \u901A\u77E5\u4E4B\u524D\u6536\u96C6\u7684\u4F9D\u8D56, \u91CD\u65B0\u6267\u884C\n     */\n    const oldValue = target[key]\n    const res = Reflect.set(target, key, newValue, receiver)\n\n    if (isRef(oldValue) && !isRef(newValue)) {\n      oldValue.value = newValue\n      // \u8FD9\u91CC\u9700\u8981\u63D0\u524D return, \u56E0\u4E3A ref.value \u66F4\u65B0\u4F1A\u89E6\u53D1 effect, \u4E0B\u9762\u4E0D\u9700\u8981\u518D\u6B21\u89E6\u53D1\n      return res\n    }\n\n    if (hasChanged(newValue, oldValue)) {\n      trigger(target, key)\n    }\n    return res\n  },\n}\n\nexport function reactive(target) {\n  return isReactive(target) ? target : createReactiveObject(target)\n}\n\nconst reactiveMap = new WeakMap()\n\nfunction createReactiveObject(target) {\n  /**\n   * reactive \u5FC5\u987B\u63A5\u53D7\u4E00\u4E2A\u5BF9\u8C61\n   */\n  if (!isObject(target)) {\n    /**\n     * target \u4E0D\u662F\u4E00\u4E2A\u5BF9\u8C61, \u54EA\u6765\u7684\u56DE\u54EA\u53BB\n     */\n    return target\n  }\n  if (isReactive(target)) return target\n  const existingProxy = reactiveMap.get(target)\n  if (existingProxy) {\n    return existingProxy\n  }\n  /**\n   * \u521B\u5EFA target \u7684\u4EE3\u7406\u5BF9\u8C61\n   */\n  const proxy = new Proxy(target, mutableHandlers)\n  reactiveMap.set(target, proxy)\n\n  return proxy\n}\n\n/**\n * \u7ED1\u5B9A target \u7684 key \u5173\u8054\u7684\u6240\u6709 Dep\n * obj = { a: 0, b: 1 }\n * targetMap = {\n *   [obj]: {\n *     a: Dep,\n *     b: Dep,\n *   }\n * }\n */\nconst targetMap = new WeakMap()\n\nfunction track(target, key) {\n  if (!activeSub) return\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = new Dep(target[key])))\n  }\n  link(dep, activeSub)\n}\n\nfunction trigger(target, key) {\n  const depsMap = targetMap.get(target)\n  if (!depsMap) return\n  const dep = depsMap.get(key)\n  if (!dep) return\n  propagate(dep.subs)\n}\n\nexport function isReactive(value) {\n  return !!(value && value['__v_isReactive'])\n}\n", "import { activeSub } from './effect'\nimport { link, propagate } from './system'\nimport { hasChanged, isObject } from '@vue/shared'\nimport { reactive } from './reactive'\nimport { Dep } from './dep'\n\nexport enum ReactiveFlags {\n  IS_REF = '__v_isRef',\n}\n\nexport class RefImpl {\n  // \u4FDD\u5B58\u5B9E\u9645\u7684\u503C\n  _value;\n  // ref \u6807\u8BB0, \u8BC1\u660E\u662F\u4E00\u4E2A ref\n  [ReactiveFlags.IS_REF] = true\n\n  dep: Dep\n  constructor(value) {\n    this.dep = new Dep(this)\n    /**\n     * \u5982\u679C value \u662F\u4E00\u4E2A\u5BF9\u8C61, \u90A3\u4E48\u6211\u4EEC\u4F7F\u7528 reactive \u5BF9\u5B83\u5904\u7406\u4E3A\u54CD\u5E94\u5F0F\u5BF9\u8C61\n     */\n    this._value = isObject(value) ? reactive(value) : value\n  }\n  get value() {\n    track(this.dep)\n    return this._value\n  }\n  set value(newValue) {\n    const oldValue = this._value\n    this._value = isObject(newValue) ? reactive(newValue) : newValue\n    if (hasChanged(newValue, oldValue)) {\n      trigger(this.dep)\n    }\n  }\n}\n\n/**\n * \u6536\u96C6\u4F9D\u8D56\n */\nfunction track(dep: Dep) {\n  if (activeSub) {\n    link(dep, activeSub)\n  }\n}\n\n/**\n * \u89E6\u53D1\u66F4\u65B0\n */\nfunction trigger(dep: Dep) {\n  if (dep.subs) {\n    propagate(dep.subs)\n  }\n}\n\nexport function ref(value) {\n  return new RefImpl(value)\n}\n\n/**\n * \u5224\u65AD\u662F\u4E0D\u662F\u4E00\u4E2Aref\n * @param value\n */\nexport function isRef(value) {\n  return !!(value && value[ReactiveFlags.IS_REF])\n}\n", "import { hasChanged, isFunction } from '@vue/shared'\nimport { ReactiveFlags } from './ref'\nimport { Dep, Sub } from './dep'\nimport { activeSub, ReactiveEffect, setActiveSub } from './effect'\nimport { endTrack, link, Link, propagate, startTrack } from './system'\n\nexport class ComputedRefImpl implements Dep, Sub {\n  // computed \u4E5F\u662F\u4E00\u4E2A ref, \u901A\u8FC7 isRef \u4E5F\u8FD4\u56DE true\n  [ReactiveFlags.IS_REF] = true\n\n  // \u4FDD\u5B58 fn \u7684\u8FD4\u56DE\u503C\n  _value\n\n  //region \u4F5C\u4E3A dep, \u8981\u5173\u8054 subs, \u7B49\u6211\u7684\u503C\u66F4\u65B0\u4E86, \u6211\u8981\u901A\u77E5\u5B83\u4EEC\u91CD\u65B0\u6267\u884C\n  /**\n   * \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9, \u7406\u89E3\u4E3A\u6211\u4EEC\u8BB2\u7684 head\n   */\n  subs: Link\n\n  /**\n   * \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9, \u7406\u89E3\u4E3A\u6211\u4EEC\u8BB2\u7684 tail\n   */\n  subsTail: Link\n  //endregion\n\n  //region \u4F5C\u4E3A dep, \u8981\u5173\u8054 subs, \u7B49\u6211\u7684\u503C\u66F4\u65B0\u4E86, \u6211\u8981\u901A\u77E5\u5B83\u4EEC\u91CD\u65B0\u6267\u884C\n  /**\n   * \u4F9D\u8D56\u9879\u94FE\u8868\u7684\u5934\u8282\u70B9\n   */\n  deps: Link | undefined\n\n  /**\n   * \u4F9D\u8D56\u9879\u94FE\u8868\u7684\u5C3E\u8282\u70B9\n   */\n  depsTail: Link | undefined\n\n  tracking = false\n  //endregion\n\n  // \u8BA1\u7B97\u5C5E\u6027, \u810F\u4E0D\u810F, \u5982\u679C dirty \u4E3A true, \u8868\u793A\u8BA1\u7B97\u5C5E\u6027\u662F\u810F\u7684\n  // get value \u7684\u65F6\u5019, \u9700\u8981\u6267\u884C update\n  dirty = true\n\n  constructor(\n    public fn, // getter\n    private setter,\n  ) {}\n\n  get value() {\n    if (this.dirty) {\n      this.update()\n    }\n    /**\n     * \u8981\u548C sub \u505A\u5173\u8054\u5173\u7CFB\n     */\n    // \u6536\u96C6\u4F9D\u8D56\n    if (activeSub) {\n      link(this, activeSub)\n    }\n    return this._value\n  }\n\n  set value(newValue) {\n    if (this.setter) {\n      this.setter(newValue)\n    } else {\n      console.warn('\u6211\u662F\u53EA\u8BFB\u7684, \u4F60\u522B\u778E\u73A9\u4E86')\n    }\n  }\n\n  update() {\n    /**\n     * \u5B9E\u73B0 sub \u7684\u529F\u80FD, \u4E3A\u4E86\u5728\u6267\u884C fn \u671F\u95F4, \u6536\u96C6 fn \u6267\u884C\u8FC7\u7A0B\u4E2D\u8BBF\u95EE\u5230\u7684\u54CD\u5E94\u5F0F\u6570\u636E\n     * \u5EFA\u7ACB dep \u548C sub \u4E4B\u95F4\u7684\u5173\u8054\u5173\u7CFB\n     */\n    // \u5148\u5C06\u5F53\u524D\u7684 effect \u4FDD\u5B58\u8D77\u6765, \u7528\u6765\u5904\u7406\u5D4C\u5957\u7684\u903B\u8F91\n    const prevSub = activeSub\n\n    // \u6BCF\u6B21\u6267\u884C fn \u4E4B\u524D, \u628A this \u653E\u5230 activeSub \u4E0A\u95E8\n    setActiveSub(this)\n    startTrack(this)\n    try {\n      // \u62FF\u5230\u8001\u503C\n      const oldValue = this._value\n      // \u62FF\u5230\u65B0\u503C\n      this._value = this.fn()\n      // \u5982\u679C\u503C\u53D1\u751F\u4E86\u53D8\u5316, \u5C31\u8FD4\u56DEtrue, \u5426\u5219\u5C31\u662F false\n      return hasChanged(this._value, oldValue)\n    } finally {\n      endTrack(this)\n\n      // \u6267\u884C\u5B8C\u6210\u540E, \u6062\u590D\u4E4B\u524D\u7684 effect\n      setActiveSub(prevSub)\n    }\n  }\n}\n\n// ==============================  ==============================\n//region 123\n\n//endregion\n/**\n * \u8BA1\u7B97\u5C5E\u6027\n * @param getterOrOptions \u6709\u53EF\u80FD\u662F\u4E00\u4E2A \u51FD\u6570,\n * \u4E5F\u6709\u53EF\u80FD\u662F\u4E00\u4E2A\u5BF9\u8C61, \u5BF9\u8C61\u7684\u8BDD, \u91CC\u9762\u6709 get \u548C set \u5C5E\u6027\n */\nexport function computed(getterOrOptions) {\n  let getter\n  let setter\n\n  if (isFunction(getterOrOptions)) {\n    /**\n     * const c = computed(()=>{})\n     */\n    getter = getterOrOptions\n  } else {\n    /**\n     * const c = computed({\n     *   get(){},\n     *   set(){},\n     * })\n     */\n    getter = getterOrOptions.get\n    setter = getterOrOptions.set\n  }\n  return new ComputedRefImpl(getter, setter)\n}\n", "import { ReactiveEffect } from './effect'\nimport { isRef } from './ref'\nimport { isObject } from '@vue/shared'\n\nexport function watch(source, cb, options = {}) {\n  const { immediate, once, deep } = options\n\n  if (once) {\n    // \u5982\u679C once \u4F20\u4E86, \u90A3\u5C31\u4FDD\u5B58\u4E00\u4EFD, \u65B0\u7684 cb \u7B49\u4E8E,\u76F4\u63A5\u8C03\u7528\u539F\u6765\u7684, \u52A0\u4E0A stop \u505C\u6B62\u76D1\u542C\n    const _cb = cb\n    cb = (...args) => {\n      _cb(...args)\n      effect.stop()\n    }\n  }\n\n  let getter\n\n  if (isRef(source)) {\n    getter = () => (deep ? source.value : source.value)\n  }\n\n  if (deep) {\n    const baseGetter = getter\n    getter = () => traverse(baseGetter())\n  }\n\n  let oldValue\n\n  function job() {\n    // \u6267\u884C effect.run \u62FF\u5230 getter \u7684\u8FD4\u56DE\u503C, \u4E0D\u80FD\u76F4\u63A5\u6267\u884C getter, \u56E0\u4E3A\u8981\u6536\u96C6\u4F9D\u8D56\n    const newValue = effect.run()\n    // \u6267\u884C\u7528\u6237\u56DE\u8C03, \u628A newValue \u548C oldValue \u4F20\u8FDB\u53BB\n    cb(newValue, oldValue)\n    // \u4E0B\u4E00\u6B21\u7684 oldValue \u5C31\u7B49\u4E8E\u8FD9\u4E00\u6B21\u7684 newValue\n    oldValue = newValue\n  }\n\n  const effect = new ReactiveEffect(getter)\n  effect.scheduler = job\n\n  if (immediate) {\n    job()\n  } else {\n    oldValue = effect.run()\n  }\n\n  return () => {\n    effect.stop()\n  }\n}\n\nfunction traverse(value, seen = new Set()) {\n  if (!isObject(value)) {\n    return value\n  }\n\n  if (seen.has(value)) {\n    return value\n  }\n  seen.add(value)\n\n  for (const key in value) {\n    const item = value[key]\n    traverse(item, seen)\n  }\n\n  return value\n}\n"],
  "mappings": "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",
  "names": ["link", "effect", "ReactiveFlags", "track", "trigger", "effect"]
}
