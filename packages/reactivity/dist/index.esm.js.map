{
  "version": 3,
  "sources": ["../src/effect.ts", "../src/system.ts", "../src/ref.ts"],
  "sourcesContent": ["import { Link } from './system'\n\ninterface Fn {\n  (...args: any[]): any\n}\n\nexport let activeSub: ReactiveEffect | undefined\n\nexport class ReactiveEffect {\n  deps: Link\n  depsTail: Link\n  constructor(public fn) {}\n  run() {\n    const prevSub = activeSub\n    activeSub = this\n    try {\n      return this.fn()\n    } finally {\n      activeSub = prevSub\n    }\n  }\n  scheduler() {\n    this.run()\n  }\n  notify() {\n    this.scheduler()\n  }\n}\n\nexport function effect(fn: Fn, options?: { scheduler?: Fn }) {\n  const e = new ReactiveEffect(fn)\n  if (options) {\n    Object.assign(e, options)\n  }\n  e.run()\n}\n", "import { ReactiveEffect } from './effect'\n\nexport class Dep {\n  subs: Link | undefined\n  subsTail: Link | undefined\n}\n\nexport class Link {\n  dep: Dep\n  sub: ReactiveEffect\n  nextSub: Link | undefined\n  prevSub: Link | undefined\n\n  constructor(dep: Dep, sub: ReactiveEffect) {\n    this.dep = dep\n    this.sub = sub\n  }\n}\n\n/**\n * \u94FE\u63A5\u94FE\u8868\u5173\u7CFB\n * @param dep\n * @param sub\n */\nexport function link(dep: Dep, sub: ReactiveEffect) {\n  const link = new Link(dep, sub)\n  // \u6CA1\u6709\u5C3E \u8BF4\u660E\u662F\u65B0\u7684, \u5934\u5C3E\u76F8\u540C\n  /**\n   * \u5173\u8054\u94FE\u8868\u5173\u7CFB, \u5206\u4E24\u79CD\u60C5\u51B5\n   * 1. \u5C3E\u8282\u70B9\u6CA1\u6709, \u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054, \u90A3\u5C31\u5F80\u5934\u8282\u70B9\u52A0, \u5934\u5C3E\u76F8\u540C\n   * 2. \u5C3E\u8282\u70B9\u6709, \u90A3\u5C31\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0, \u5E76\u4E14\u66F4\u65B0\u5C3E\u6307\u9488\n   */\n  if (!dep.subsTail) {\n    dep.subs = link\n    dep.subsTail = link\n  } else {\n    dep.subsTail.nextSub = link\n    link.prevSub = dep.subsTail\n    dep.subsTail = link\n  }\n}\n\n/**\n * \u4F20\u64AD\u66F4\u65B0\u7684\u51FD\u6570\n * @param subs\n */\nexport function propagate(subs: Link) {\n  let link = subs\n  const queuedEffects = []\n  while (link) {\n    queuedEffects.push(link.sub)\n    link = link.nextSub\n  }\n  queuedEffects.forEach(effect => effect.notify())\n}\n", "import { activeSub } from './effect'\nimport { Dep, link, propagate } from './system'\n\nenum ReactiviFlags {\n  IS_REF = '__v_isRef',\n}\n\nexport class RefImpl {\n  // \u4FDD\u5B58\u5B9E\u9645\u7684\u503C\n  _value;\n  // ref \u6807\u8BB0, \u8BC1\u660E\u662F\u4E00\u4E2A ref\n  [ReactiviFlags.IS_REF]: true\n\n  dep = new Dep()\n  constructor(value) {\n    this._value = value\n  }\n  get value() {\n    track(this)\n    return this._value\n  }\n  set value(newValue) {\n    this._value = newValue\n    trigger(this.dep)\n  }\n}\n\n/**\n * \u6536\u96C6\u4F9D\u8D56\n */\nfunction track(self: RefImpl) {\n  if (activeSub) {\n    link(self.dep, activeSub)\n  }\n}\n\n/**\n * \u89E6\u53D1\u66F4\u65B0\n */\nfunction trigger(dep: Dep) {\n  if (dep.subs) {\n    propagate(dep.subs)\n  }\n}\n\nexport function ref(value) {\n  return new RefImpl(value)\n}\n\n/**\n * \u5224\u65AD\u662F\u4E0D\u662F\u4E00\u4E2Aref\n * @param value\n */\nexport function isRef(value) {\n  return !!(value && value[ReactiviFlags.IS_REF])\n}\n"],
  "mappings": ";AAMO,IAAI;AAEJ,IAAM,iBAAN,MAAqB;AAAA,EAG1B,YAAmB,IAAI;AAAJ;AAAA,EAAK;AAAA,EAFxB;AAAA,EACA;AAAA,EAEA,MAAM;AACJ,UAAM,UAAU;AAChB,gBAAY;AACZ,QAAI;AACF,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AACA,kBAAY;AAAA,IACd;AAAA,EACF;AAAA,EACA,YAAY;AACV,SAAK,IAAI;AAAA,EACX;AAAA,EACA,SAAS;AACP,SAAK,UAAU;AAAA,EACjB;AACF;AAEO,SAAS,OAAO,IAAQ,SAA8B;AAC3D,QAAM,IAAI,IAAI,eAAe,EAAE;AAC/B,MAAI,SAAS;AACX,WAAO,OAAO,GAAG,OAAO;AAAA,EAC1B;AACA,IAAE,IAAI;AACR;;;ACjCO,IAAM,MAAN,MAAU;AAAA,EACf;AAAA,EACA;AACF;AAEO,IAAM,OAAN,MAAW;AAAA,EAChB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAEA,YAAY,KAAU,KAAqB;AACzC,SAAK,MAAM;AACX,SAAK,MAAM;AAAA,EACb;AACF;AAOO,SAAS,KAAK,KAAU,KAAqB;AAClD,QAAMA,QAAO,IAAI,KAAK,KAAK,GAAG;AAO9B,MAAI,CAAC,IAAI,UAAU;AACjB,QAAI,OAAOA;AACX,QAAI,WAAWA;AAAA,EACjB,OAAO;AACL,QAAI,SAAS,UAAUA;AACvB,IAAAA,MAAK,UAAU,IAAI;AACnB,QAAI,WAAWA;AAAA,EACjB;AACF;AAMO,SAAS,UAAU,MAAY;AACpC,MAAIA,QAAO;AACX,QAAM,gBAAgB,CAAC;AACvB,SAAOA,OAAM;AACX,kBAAc,KAAKA,MAAK,GAAG;AAC3B,IAAAA,QAAOA,MAAK;AAAA,EACd;AACA,gBAAc,QAAQ,CAAAC,YAAUA,QAAO,OAAO,CAAC;AACjD;;;AC/CO,IAAM,UAAN,MAAc;AAAA;AAAA,EAEnB;AAAA;AAAA,EAEA,CAAC,wBAAoB;AAAA,EAErB,MAAM,IAAI,IAAI;AAAA,EACd,YAAY,OAAO;AACjB,SAAK,SAAS;AAAA,EAChB;AAAA,EACA,IAAI,QAAQ;AACV,UAAM,IAAI;AACV,WAAO,KAAK;AAAA,EACd;AAAA,EACA,IAAI,MAAM,UAAU;AAClB,SAAK,SAAS;AACd,YAAQ,KAAK,GAAG;AAAA,EAClB;AACF;AAKA,SAAS,MAAM,MAAe;AAC5B,MAAI,WAAW;AACb,SAAK,KAAK,KAAK,SAAS;AAAA,EAC1B;AACF;AAKA,SAAS,QAAQ,KAAU;AACzB,MAAI,IAAI,MAAM;AACZ,cAAU,IAAI,IAAI;AAAA,EACpB;AACF;AAEO,SAAS,IAAI,OAAO;AACzB,SAAO,IAAI,QAAQ,KAAK;AAC1B;AAMO,SAAS,MAAM,OAAO;AAC3B,SAAO,CAAC,EAAE,SAAS,MAAM,wBAAoB;AAC/C;",
  "names": ["link", "effect"]
}
