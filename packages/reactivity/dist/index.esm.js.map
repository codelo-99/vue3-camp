{
  "version": 3,
  "sources": ["../src/effect.ts", "../src/ref.ts"],
  "sourcesContent": ["import { Link } from './ref'\n\ninterface Fn {\n  (...args: any[]): any\n}\n\nexport let activeSub: ReactiveEffect | undefined\n\nexport class ReactiveEffect {\n  deps: Link\n  depsTail: Link\n  fn: Fn\n  constructor(fn: Fn) {\n    this.fn = fn\n  }\n}\n\nexport function effect(fn: Fn) {\n  activeSub = new ReactiveEffect(fn)\n  fn()\n  activeSub = undefined\n}\n", "import { activeSub, ReactiveEffect } from './effect'\n\nenum ReactiviFlags {\n  IS_REF = '__v_isRef',\n}\n\nexport class Dep {\n  subs: Link | undefined\n}\n\nexport class Link {\n  dep: Dep\n  sub: ReactiveEffect\n  constructor(dep: Dep, sub: ReactiveEffect) {\n    this.dep = dep\n    this.sub = sub\n  }\n}\n\nexport class RefImpl {\n  // \u4FDD\u5B58\u5B9E\u9645\u7684\u503C\n  _value;\n  // ref \u6807\u8BB0, \u8BC1\u660E\u662F\u4E00\u4E2A ref\n  [ReactiviFlags.IS_REF]: true\n\n  dep = new Dep()\n  constructor(value) {\n    this._value = value\n  }\n  get value() {\n    track(this)\n    return this._value\n  }\n  set value(newValue) {\n    this._value = newValue\n    trigger(this)\n  }\n}\n\n/**\n * \u6536\u96C6\u4F9D\u8D56\n */\nfunction track(self: RefImpl) {\n  console.log('\u6536\u96C6\u4F9D\u8D56', self)\n  if (activeSub) {\n    if (!self.dep.subs) {\n      self.dep.subs = new Link(self.dep, activeSub)\n    }\n  }\n}\n\n/**\n * \u89E6\u53D1\u66F4\u65B0\n */\nfunction trigger(self: RefImpl) {\n  console.log(self)\n  // self.dep.forEach(fn => fn())\n  self.dep.subs.sub.fn()\n}\n\nexport function ref(value) {\n  return new RefImpl(value)\n}\n\n/**\n * \u5224\u65AD\u662F\u4E0D\u662F\u4E00\u4E2Aref\n * @param value\n */\nexport function isRef(value) {\n  return !!(value && value[ReactiviFlags.IS_REF])\n}\n"],
  "mappings": ";AAMO,IAAI;AAEJ,IAAM,iBAAN,MAAqB;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACA,YAAY,IAAQ;AAClB,SAAK,KAAK;AAAA,EACZ;AACF;AAEO,SAAS,OAAO,IAAQ;AAC7B,cAAY,IAAI,eAAe,EAAE;AACjC,KAAG;AACH,cAAY;AACd;;;ACfO,IAAM,MAAN,MAAU;AAAA,EACf;AACF;AAEO,IAAM,OAAN,MAAW;AAAA,EAChB;AAAA,EACA;AAAA,EACA,YAAY,KAAU,KAAqB;AACzC,SAAK,MAAM;AACX,SAAK,MAAM;AAAA,EACb;AACF;AAEO,IAAM,UAAN,MAAc;AAAA;AAAA,EAEnB;AAAA;AAAA,EAEA,CAAC,wBAAoB;AAAA,EAErB,MAAM,IAAI,IAAI;AAAA,EACd,YAAY,OAAO;AACjB,SAAK,SAAS;AAAA,EAChB;AAAA,EACA,IAAI,QAAQ;AACV,UAAM,IAAI;AACV,WAAO,KAAK;AAAA,EACd;AAAA,EACA,IAAI,MAAM,UAAU;AAClB,SAAK,SAAS;AACd,YAAQ,IAAI;AAAA,EACd;AACF;AAKA,SAAS,MAAM,MAAe;AAC5B,UAAQ,IAAI,4BAAQ,IAAI;AACxB,MAAI,WAAW;AACb,QAAI,CAAC,KAAK,IAAI,MAAM;AAClB,WAAK,IAAI,OAAO,IAAI,KAAK,KAAK,KAAK,SAAS;AAAA,IAC9C;AAAA,EACF;AACF;AAKA,SAAS,QAAQ,MAAe;AAC9B,UAAQ,IAAI,IAAI;AAEhB,OAAK,IAAI,KAAK,IAAI,GAAG;AACvB;AAEO,SAAS,IAAI,OAAO;AACzB,SAAO,IAAI,QAAQ,KAAK;AAC1B;AAMO,SAAS,MAAM,OAAO;AAC3B,SAAO,CAAC,EAAE,SAAS,MAAM,wBAAoB;AAC/C;",
  "names": []
}
