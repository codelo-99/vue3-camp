{
  "version": 3,
  "sources": ["../src/system.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/dep.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts", "../src/watch.ts"],
  "sourcesContent": ["import { ReactiveEffect } from './effect'\r\nimport { Dep, Sub } from './dep'\r\nimport { ComputedRefImpl } from './computed'\r\n\r\nexport class Link {\r\n  dep: Dep\r\n  sub: Sub\r\n  nextSub: Link | undefined\r\n  prevSub: Link | undefined\r\n  nextDep: Link | undefined\r\n\r\n  constructor(dep: Dep, sub: Sub) {\r\n    this.dep = dep\r\n    this.sub = sub\r\n  }\r\n}\r\n\r\n/**\r\n * \u94FE\u63A5\u94FE\u8868\u5173\u7CFB\r\n * @param dep\r\n * @param sub\r\n */\r\nexport function link(dep: Dep, sub: Sub) {\r\n  const currentDep = sub.depsTail\r\n  const nextDep = currentDep === undefined ? sub.deps : currentDep.nextDep\r\n\r\n  if (nextDep && nextDep.dep === dep) {\r\n    sub.depsTail = nextDep\r\n    return\r\n  }\r\n\r\n  const link = new Link(dep, sub)\r\n\r\n  // \u5C06\u672A\u88AB\u590D\u7528\u7684\u8282\u70B9\u653E\u5728\u5F53\u524D\u8282\u70B9\u7684\u540E\u9762, \u7528\u4E8E\u6E05\u7406\r\n  link.nextDep = nextDep\r\n\r\n  /**\r\n   * \u5173\u8054\u94FE\u8868\u548Cdep\u7684\u5173\u7CFB, \u5206\u4E24\u79CD\u60C5\u51B5\r\n   * 1. \u5C3E\u8282\u70B9\u6CA1\u6709, \u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054, \u90A3\u5C31\u5F80\u5934\u8282\u70B9\u52A0, \u5934\u5C3E\u76F8\u540C\r\n   * 2. \u5C3E\u8282\u70B9\u6709, \u90A3\u5C31\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0, \u5E76\u4E14\u66F4\u65B0\u5C3E\u6307\u9488\r\n   */\r\n  if (!dep.subsTail) {\r\n    dep.subs = link\r\n    dep.subsTail = link\r\n  } else {\r\n    dep.subsTail.nextSub = link\r\n    link.prevSub = dep.subsTail\r\n    dep.subsTail = link\r\n  }\r\n\r\n  /**\r\n   * \u5173\u8054\u94FE\u8868\u548Csub\u7684\u5173\u7CFB,\u5206\u4E24\u79CD\u60C5\u51B5\r\n   * 1. \u5C3E\u8282\u70B9\u6CA1\u6709, \u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054, \u90A3\u5C31\u5F80\u5934\u8282\u70B9\u52A0, \u5934\u5C3E\u76F8\u540C\r\n   * 2. \u5C3E\u8282\u70B9\u6709, \u90A3\u5C31\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0, \u5E76\u4E14\u66F4\u65B0\u5C3E\u6307\u9488\r\n   */\r\n  if (!sub.depsTail) {\r\n    sub.deps = link\r\n    sub.depsTail = link\r\n  } else {\r\n    sub.depsTail.nextDep = link\r\n    sub.depsTail = link\r\n  }\r\n}\r\n\r\nfunction processComputedUpdate(sub: ComputedRefImpl) {\r\n  /**\r\n   * \u66F4\u65B0\u8BA1\u7B97\u5C5E\u6027\r\n   * 1. \u8C03\u7528 update\r\n   * 2. \u901A\u77E5 subs \u94FE\u8868\u4E0A\u6240\u6709\u7684 sub, \u91CD\u65B0\u6267\u884C\r\n   */\r\n  if (sub.subs && sub.update()) {\r\n    propagate(sub.subs)\r\n  }\r\n}\r\n\r\n/**\r\n * \u4F20\u64AD\u66F4\u65B0\u7684\u51FD\u6570\r\n * @param subs\r\n */\r\nexport function propagate(subs: Link) {\r\n  let link = subs\r\n  const queuedEffects = []\r\n  while (link) {\r\n    const sub = link.sub\r\n    if (!sub.tracking && !sub.dirty) {\r\n      sub.dirty = true\r\n      if ('update' in sub) {\r\n        // TODO \u5904\u7406 computed\r\n        processComputedUpdate(sub)\r\n      } else {\r\n        queuedEffects.push(sub)\r\n      }\r\n    }\r\n    link = link.nextSub\r\n  }\r\n  queuedEffects.forEach(effect => effect.notify())\r\n}\r\n\r\n/**\r\n * \u5F00\u59CB\u8FFD\u8E2A\u4F9D\u8D56, \u5C06depsTail\u5C3E\u8282\u70B9\u8BBE\u7F6E\u6210undefined\r\n * @param sub\r\n */\r\nexport function startTrack(sub: Sub) {\r\n  sub.tracking = true\r\n  // \u526F\u4F5C\u7528\u51FD\u6570\u9996\u6B21\u6216\u91CD\u590D\u6267\u884C\u65F6, \u5C06\u5C3E\u8282\u70B9\u7F6E\u4E3A\u7A7A, \u5F00\u59CB\u91CD\u65B0\u6536\u96C6\u4F9D\u8D56\r\n  sub.depsTail = undefined\r\n}\r\n\r\n/**\r\n * \u7ED3\u675F\u8FFD\u8E2A\uFF0C\u627E\u5230\u9700\u8981\u6E05\u7406\u7684\u4F9D\u8D56\uFF0C\u65AD\u5F00\u5173\u8054\u5173\u7CFB\r\n * @param sub\r\n */\r\nexport function endTrack(sub: Sub) {\r\n  sub.tracking = false\r\n  const depsTail = sub.depsTail\r\n  // \u8FFD\u8E2A\u5B8C\u4E86\uFF0C\u4E0D\u810F\u4E86\r\n  sub.dirty = false\r\n  /**\r\n   * 1. \u7ED3\u675F\u8FFD\u8E2A\u540E, \u6709   \u5C3E\u8282\u70B9 \u5E76\u4E14\u8FD8\u6709\u4E0B\u4E00\u4E2A\u8282\u70B9, \u5219\u6E05\u7406\u6389\u4ED6\u4EEC\r\n   * 2. \u7ED3\u675F\u8FFD\u8E2A\u540E, \u6CA1\u6709 \u5C3E\u8282\u70B9, \u5219\u4ECE\u5934\u90E8\u5F00\u59CB\u6E05\u7406\r\n   */\r\n  if (depsTail) {\r\n    if (depsTail.nextDep) {\r\n      clearTracking(depsTail.nextDep)\r\n      depsTail.nextDep = undefined\r\n    }\r\n  } else {\r\n    clearTracking(sub.deps)\r\n    sub.deps = undefined\r\n  }\r\n}\r\n\r\n/**\r\n * \u6E05\u9664\u4F9D\u8D56\u94FE\u8868\u5173\u7CFB\r\n * @param link\r\n */\r\nexport function clearTracking(link: Link) {\r\n  while (link) {\r\n    const { nextSub, nextDep, prevSub } = link\r\n\r\n    /**\r\n     * \u5904\u7406\u7EB5\u5411\u94FE\u8868\r\n     * 1. \u5982\u679C\u5F53\u524D\u8282\u70B9\u6709\u4E0A\u4E00\u4E2A\u8282\u70B9, \u5C31\u5C06\u4E0A\u4E00\u4E2A\u8282\u70B9\u7684nextSub\u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u4E0B\u4E00\u4E2A\u8282\u70B9, \u5F53\u524D\u8282\u70B9\u7684nextSub\u7F6E\u7A7A\r\n     * 2. \u5426\u5219\u4EE3\u8868\u5F53\u524D\u662F\u5934\u8282\u70B9, \u5C06\u5934\u8282\u70B9\u6307\u9488\u6307\u5411\u4E0B\u4E00\u4E2A\u8282\u70B9\r\n     */\r\n    if (prevSub) {\r\n      prevSub.nextSub = nextSub\r\n      link.nextSub = undefined\r\n    } else {\r\n      link.dep.subs = nextSub\r\n    }\r\n\r\n    /**\r\n     * \u5904\u7406\u6A2A\u5411\u94FE\u8868\r\n     * 1. \u5982\u679C\u5F53\u524D\u8282\u70B9\u6709\u4E0B\u4E00\u4E2A\u8282\u70B9, \u5C31\u628A\u4E0B\u4E00\u4E2A\u8282\u70B9\u7684prevSub, \u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u4E0A\u4E00\u4E2A\u8282\u70B9, \u5F53\u524D\u8282\u70B9\u7684prevSub\u7F6E\u7A7A\r\n     * 2. \u5426\u5219\u4EE3\u8868\u5F53\u524D\u8282\u70B9\u662F\u5C3E\u8282\u70B9, \u5C06\u5C3E\u8282\u70B9\u6307\u9488\u6307\u5411\u5F53\u524D\u8282\u70B9\u7684\u4E0A\u4E00\u4E2A\u8282\u70B9\r\n     */\r\n    if (nextSub) {\r\n      nextDep.prevSub = prevSub\r\n      link.prevSub = undefined\r\n    } else {\r\n      link.dep.subsTail = prevSub\r\n    }\r\n\r\n    link.dep = undefined\r\n    link.sub = undefined\r\n\r\n    link = nextDep\r\n  }\r\n}\r\n", "import { endTrack, Link, startTrack } from './system'\nimport { Sub } from './dep'\n\ninterface Fn {\n  (...args: any[]): any\n}\n\nexport let activeSub: Sub | undefined\n\nexport function setActiveSub(sub: Sub) {\n  activeSub = sub\n}\n\nexport class ReactiveEffect {\n  // \u8868\u793A\u8FD9\u4E2A effect \u662F\u5426\u6FC0\u6D3B\n  active = true\n\n  deps: Link | undefined\n  depsTail: Link | undefined\n  tracking = false\n  dirty = false\n\n  constructor(public fn) {}\n  run() {\n    const prevSub = activeSub\n    setActiveSub(this)\n    // if (this.deps && this.deps.dep) {\n    //   this.deps.dep.subsTail = undefined\n    // }\n\n    startTrack(this)\n    try {\n      return this.fn()\n    } finally {\n      endTrack(this)\n      setActiveSub(prevSub)\n    }\n  }\n  scheduler() {\n    this.run()\n  }\n  notify() {\n    this.scheduler()\n  }\n  stop() {\n    console.log('stop')\n    if (this.active) {\n      // \u6E05\u7406\u4F9D\u8D56\n      startTrack(this)\n      endTrack(this)\n    }\n  }\n}\n\nexport function effect(fn: Fn, options?: { scheduler?: Fn }) {\n  const e = new ReactiveEffect(fn)\n  if (options) {\n    Object.assign(e, options)\n  }\n  e.run()\n  /**\n   * \u7ED1\u5B9A\u51FD\u6570\u7684 this\n   */\n  const runner = e.run.bind(e)\n\n  /**\n   * \u628A effect \u7684\u5B9E\u4F8B, \u653E\u5230\u51FD\u6570\u5C5E\u6027\u4E2D\n   */\n  runner.effect = e\n  return runner\n}\n", "export function isObject(value) {\r\n  return typeof value === 'object' && value !== null\r\n}\r\n\r\nexport function hasChanged(newValue, oldValue) {\r\n  return !Object.is(newValue, oldValue)\r\n}\r\n\r\nexport function isFunction(value) {\r\n  return typeof value === 'function'\r\n}\r\n", "import { Link } from './system'\r\n\r\nexport class Dep {\r\n  subs: Link | undefined\r\n  subsTail: Link | undefined\r\n  _value\r\n  constructor(dep) {\r\n    this._value = dep\r\n  }\r\n}\r\n\r\nexport interface Sub {\r\n  deps: Link | undefined\r\n  depsTail: Link | undefined\r\n  tracking: boolean\r\n  dirty: boolean\r\n}\r\n", "import { hasChanged, isObject } from '@vue/shared'\r\nimport { activeSub } from './effect'\r\nimport { link, propagate } from './system'\r\nimport { isRef } from './ref'\r\nimport { Dep } from './dep'\r\n\r\nconst mutableHandlers = {\r\n  get(target, key, receiver) {\r\n    if (key === '__v_isReactive') return true\r\n    /**\r\n     * target = { a: 0 }\r\n     * \u6536\u96C6\u4F9D\u8D56, \u7ED1\u5B9A target \u4E2D\u67D0\u4E00\u4E2A key \u548C sub \u4E4B\u95F4\u7684\u5173\u7CFB\r\n     */\r\n\r\n    track(target, key)\r\n\r\n    const res = Reflect.get(target, key, receiver)\r\n\r\n    if (isRef(res)) {\r\n      /**\r\n       * target = { a: ref(0) }\r\n       * \u5982\u679C target.a \u662F\u4E00\u4E2A ref, \u90A3\u4E48\u5C31\u76F4\u63A5\u628A\u503C\u7ED9\u5B83, \u4E0D\u8981\u8BA9\u5B83 .value\r\n       */\r\n      return res.value\r\n    }\r\n\r\n    if (isObject(res)) {\r\n      /**\r\n       * \u5982\u679C\u8BBF\u95EE\u7684\u662F\u5D4C\u5957\u5BF9\u8C61, \u90A3\u4E48\u5C31\u7528 reactive \u5305\u88F9\u4E00\u4E0B\r\n       */\r\n      return reactive(res)\r\n    }\r\n\r\n    return res\r\n  },\r\n  set(target, key, newValue, receiver) {\r\n    /**\r\n     * \u89E6\u53D1\u66F4\u65B0, set \u7684\u65F6\u5019, \u901A\u77E5\u4E4B\u524D\u6536\u96C6\u7684\u4F9D\u8D56, \u91CD\u65B0\u6267\u884C\r\n     */\r\n    const oldValue = target[key]\r\n    const res = Reflect.set(target, key, newValue, receiver)\r\n\r\n    if (isRef(oldValue) && !isRef(newValue)) {\r\n      oldValue.value = newValue\r\n      // \u8FD9\u91CC\u9700\u8981\u63D0\u524D return, \u56E0\u4E3A ref.value \u66F4\u65B0\u4F1A\u89E6\u53D1 effect, \u4E0B\u9762\u4E0D\u9700\u8981\u518D\u6B21\u89E6\u53D1\r\n      return res\r\n    }\r\n\r\n    if (hasChanged(newValue, oldValue)) {\r\n      trigger(target, key)\r\n    }\r\n    return res\r\n  },\r\n}\r\n\r\nexport function reactive(target) {\r\n  return isReactive(target) ? target : createReactiveObject(target)\r\n}\r\n\r\nconst reactiveMap = new WeakMap()\r\n\r\nfunction createReactiveObject(target) {\r\n  /**\r\n   * reactive \u5FC5\u987B\u63A5\u53D7\u4E00\u4E2A\u5BF9\u8C61\r\n   */\r\n  if (!isObject(target)) {\r\n    /**\r\n     * target \u4E0D\u662F\u4E00\u4E2A\u5BF9\u8C61, \u54EA\u6765\u7684\u56DE\u54EA\u53BB\r\n     */\r\n    return target\r\n  }\r\n  if (isReactive(target)) return target\r\n  const existingProxy = reactiveMap.get(target)\r\n  if (existingProxy) {\r\n    return existingProxy\r\n  }\r\n  /**\r\n   * \u521B\u5EFA target \u7684\u4EE3\u7406\u5BF9\u8C61\r\n   */\r\n  const proxy = new Proxy(target, mutableHandlers)\r\n  reactiveMap.set(target, proxy)\r\n\r\n  return proxy\r\n}\r\n\r\n/**\r\n * \u7ED1\u5B9A target \u7684 key \u5173\u8054\u7684\u6240\u6709 Dep\r\n * obj = { a: 0, b: 1 }\r\n * targetMap = {\r\n *   [obj]: {\r\n *     a: Dep,\r\n *     b: Dep,\r\n *   }\r\n * }\r\n */\r\nconst targetMap = new WeakMap()\r\n\r\nfunction track(target, key) {\r\n  if (!activeSub) return\r\n  let depsMap = targetMap.get(target)\r\n  if (!depsMap) {\r\n    targetMap.set(target, (depsMap = new Map()))\r\n  }\r\n  let dep = depsMap.get(key)\r\n  if (!dep) {\r\n    depsMap.set(key, (dep = new Dep(target[key])))\r\n  }\r\n  link(dep, activeSub)\r\n}\r\n\r\nfunction trigger(target, key) {\r\n  const depsMap = targetMap.get(target)\r\n  if (!depsMap) return\r\n  const dep = depsMap.get(key)\r\n  if (!dep) return\r\n  propagate(dep.subs)\r\n}\r\n\r\nexport function isReactive(value) {\r\n  return !!(value && value['__v_isReactive'])\r\n}\r\n", "import { activeSub } from './effect'\r\nimport { link, propagate } from './system'\r\nimport { hasChanged, isObject } from '@vue/shared'\r\nimport { reactive } from './reactive'\r\nimport { Dep } from './dep'\r\n\r\nexport enum ReactiveFlags {\r\n  IS_REF = '__v_isRef',\r\n}\r\n\r\nexport class RefImpl {\r\n  // \u4FDD\u5B58\u5B9E\u9645\u7684\u503C\r\n  _value;\r\n  // ref \u6807\u8BB0, \u8BC1\u660E\u662F\u4E00\u4E2A ref\r\n  [ReactiveFlags.IS_REF] = true\r\n\r\n  dep: Dep\r\n  constructor(value) {\r\n    this.dep = new Dep(this)\r\n    /**\r\n     * \u5982\u679C value \u662F\u4E00\u4E2A\u5BF9\u8C61, \u90A3\u4E48\u6211\u4EEC\u4F7F\u7528 reactive \u5BF9\u5B83\u5904\u7406\u4E3A\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n     */\r\n    this._value = isObject(value) ? reactive(value) : value\r\n  }\r\n  get value() {\r\n    track(this.dep)\r\n    return this._value\r\n  }\r\n  set value(newValue) {\r\n    const oldValue = this._value\r\n    this._value = isObject(newValue) ? reactive(newValue) : newValue\r\n    if (hasChanged(newValue, oldValue)) {\r\n      trigger(this.dep)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \u6536\u96C6\u4F9D\u8D56\r\n */\r\nfunction track(dep: Dep) {\r\n  if (activeSub) {\r\n    link(dep, activeSub)\r\n  }\r\n}\r\n\r\n/**\r\n * \u89E6\u53D1\u66F4\u65B0\r\n */\r\nfunction trigger(dep: Dep) {\r\n  if (dep.subs) {\r\n    propagate(dep.subs)\r\n  }\r\n}\r\n\r\nexport function ref(value) {\r\n  return new RefImpl(value)\r\n}\r\n\r\n/**\r\n * \u5224\u65AD\u662F\u4E0D\u662F\u4E00\u4E2Aref\r\n * @param value\r\n */\r\nexport function isRef(value) {\r\n  return !!(value && value[ReactiveFlags.IS_REF])\r\n}\r\n", "import { hasChanged, isFunction } from '@vue/shared'\r\nimport { ReactiveFlags } from './ref'\r\nimport { Dep, Sub } from './dep'\r\nimport { activeSub, ReactiveEffect, setActiveSub } from './effect'\r\nimport { endTrack, link, Link, propagate, startTrack } from './system'\r\n\r\nexport class ComputedRefImpl implements Dep, Sub {\r\n  // computed \u4E5F\u662F\u4E00\u4E2A ref, \u901A\u8FC7 isRef \u4E5F\u8FD4\u56DE true\r\n  [ReactiveFlags.IS_REF] = true\r\n\r\n  // \u4FDD\u5B58 fn \u7684\u8FD4\u56DE\u503C\r\n  _value\r\n\r\n  //region \u4F5C\u4E3A dep, \u8981\u5173\u8054 subs, \u7B49\u6211\u7684\u503C\u66F4\u65B0\u4E86, \u6211\u8981\u901A\u77E5\u5B83\u4EEC\u91CD\u65B0\u6267\u884C\r\n  /**\r\n   * \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9, \u7406\u89E3\u4E3A\u6211\u4EEC\u8BB2\u7684 head\r\n   */\r\n  subs: Link\r\n\r\n  /**\r\n   * \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9, \u7406\u89E3\u4E3A\u6211\u4EEC\u8BB2\u7684 tail\r\n   */\r\n  subsTail: Link\r\n  //endregion\r\n\r\n  //region \u4F5C\u4E3A dep, \u8981\u5173\u8054 subs, \u7B49\u6211\u7684\u503C\u66F4\u65B0\u4E86, \u6211\u8981\u901A\u77E5\u5B83\u4EEC\u91CD\u65B0\u6267\u884C\r\n  /**\r\n   * \u4F9D\u8D56\u9879\u94FE\u8868\u7684\u5934\u8282\u70B9\r\n   */\r\n  deps: Link | undefined\r\n\r\n  /**\r\n   * \u4F9D\u8D56\u9879\u94FE\u8868\u7684\u5C3E\u8282\u70B9\r\n   */\r\n  depsTail: Link | undefined\r\n\r\n  tracking = false\r\n  //endregion\r\n\r\n  // \u8BA1\u7B97\u5C5E\u6027, \u810F\u4E0D\u810F, \u5982\u679C dirty \u4E3A true, \u8868\u793A\u8BA1\u7B97\u5C5E\u6027\u662F\u810F\u7684\r\n  // get value \u7684\u65F6\u5019, \u9700\u8981\u6267\u884C update\r\n  dirty = true\r\n\r\n  constructor(\r\n    public fn, // getter\r\n    private setter,\r\n  ) {}\r\n\r\n  get value() {\r\n    if (this.dirty) {\r\n      this.update()\r\n    }\r\n    /**\r\n     * \u8981\u548C sub \u505A\u5173\u8054\u5173\u7CFB\r\n     */\r\n    // \u6536\u96C6\u4F9D\u8D56\r\n    if (activeSub) {\r\n      link(this, activeSub)\r\n    }\r\n    return this._value\r\n  }\r\n\r\n  set value(newValue) {\r\n    if (this.setter) {\r\n      this.setter(newValue)\r\n    } else {\r\n      console.warn('\u6211\u662F\u53EA\u8BFB\u7684, \u4F60\u522B\u778E\u73A9\u4E86')\r\n    }\r\n  }\r\n\r\n  update() {\r\n    /**\r\n     * \u5B9E\u73B0 sub \u7684\u529F\u80FD, \u4E3A\u4E86\u5728\u6267\u884C fn \u671F\u95F4, \u6536\u96C6 fn \u6267\u884C\u8FC7\u7A0B\u4E2D\u8BBF\u95EE\u5230\u7684\u54CD\u5E94\u5F0F\u6570\u636E\r\n     * \u5EFA\u7ACB dep \u548C sub \u4E4B\u95F4\u7684\u5173\u8054\u5173\u7CFB\r\n     */\r\n    // \u5148\u5C06\u5F53\u524D\u7684 effect \u4FDD\u5B58\u8D77\u6765, \u7528\u6765\u5904\u7406\u5D4C\u5957\u7684\u903B\u8F91\r\n    const prevSub = activeSub\r\n\r\n    // \u6BCF\u6B21\u6267\u884C fn \u4E4B\u524D, \u628A this \u653E\u5230 activeSub \u4E0A\u95E8\r\n    setActiveSub(this)\r\n    startTrack(this)\r\n    try {\r\n      // \u62FF\u5230\u8001\u503C\r\n      const oldValue = this._value\r\n      // \u62FF\u5230\u65B0\u503C\r\n      this._value = this.fn()\r\n      // \u5982\u679C\u503C\u53D1\u751F\u4E86\u53D8\u5316, \u5C31\u8FD4\u56DEtrue, \u5426\u5219\u5C31\u662F false\r\n      return hasChanged(this._value, oldValue)\r\n    } finally {\r\n      endTrack(this)\r\n\r\n      // \u6267\u884C\u5B8C\u6210\u540E, \u6062\u590D\u4E4B\u524D\u7684 effect\r\n      setActiveSub(prevSub)\r\n    }\r\n  }\r\n}\r\n\r\n// ==============================  ==============================\r\n//region 123\r\n\r\n//endregion\r\n/**\r\n * \u8BA1\u7B97\u5C5E\u6027\r\n * @param getterOrOptions \u6709\u53EF\u80FD\u662F\u4E00\u4E2A \u51FD\u6570,\r\n * \u4E5F\u6709\u53EF\u80FD\u662F\u4E00\u4E2A\u5BF9\u8C61, \u5BF9\u8C61\u7684\u8BDD, \u91CC\u9762\u6709 get \u548C set \u5C5E\u6027\r\n */\r\nexport function computed(getterOrOptions) {\r\n  let getter\r\n  let setter\r\n\r\n  if (isFunction(getterOrOptions)) {\r\n    /**\r\n     * const c = computed(()=>{})\r\n     */\r\n    getter = getterOrOptions\r\n  } else {\r\n    /**\r\n     * const c = computed({\r\n     *   get(){},\r\n     *   set(){},\r\n     * })\r\n     */\r\n    getter = getterOrOptions.get\r\n    setter = getterOrOptions.set\r\n  }\r\n  return new ComputedRefImpl(getter, setter)\r\n}\r\n", "import { ReactiveEffect } from './effect'\nimport { isRef } from './ref'\n\nexport function watch(source, cb, options) {\n  let getter\n\n  if (isRef(source)) {\n    getter = () => source.value\n  }\n\n  let oldValue\n\n  function job() {\n    // \u6267\u884C effect.run \u62FF\u5230 getter \u7684\u8FD4\u56DE\u503C, \u4E0D\u80FD\u76F4\u63A5\u6267\u884C getter, \u56E0\u4E3A\u8981\u6536\u96C6\u4F9D\u8D56\n    const newValue = effect.run()\n    // \u6267\u884C\u7528\u6237\u56DE\u8C03, \u628A newValue \u548C oldValue \u4F20\u8FDB\u53BB\n    cb(newValue, oldValue)\n    // \u4E0B\u4E00\u6B21\u7684 oldValue \u5C31\u7B49\u4E8E\u8FD9\u4E00\u6B21\u7684 newValue\n    oldValue = newValue\n  }\n\n  const effect = new ReactiveEffect(getter)\n  effect.scheduler = job\n\n  oldValue = effect.run()\n\n  return () => {\n    effect.stop()\n  }\n}\n"],
  "mappings": "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",
  "names": ["link", "effect", "ReactiveFlags", "track", "trigger", "effect"]
}
